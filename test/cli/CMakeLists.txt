set(HEADLESS_CLI headless-cli${CMAKE_EXECUTABLE_SUFFIX})

file(GLOB HEADLESS_CLI_SOURCES RELATIVE "${CMAKE_CURRENT_SOURCE_DIR}" "*.go")

add_custom_command(OUTPUT ${CMAKE_CURRENT_BINARY_DIR}/${HEADLESS_CLI}
  COMMAND env GOPATH=${GOPATH} ${CMAKE_Go_COMPILER} build
  -buildmode=exe
  -o ${CMAKE_CURRENT_BINARY_DIR}/${HEADLESS_CLI}
  ${CMAKE_CURRENT_SOURCE_DIR}
  DEPENDS   gen_rpc
    ${HEADLESS_CLI_SOURCES}
    ${RPC_SOURCES}
  WORKING_DIRECTORY ${CMAKE_CURRENT_LIST_DIR}
  VERBATIM
)

add_custom_target(headless_cli ALL DEPENDS
  ${CMAKE_CURRENT_BINARY_DIR}/${HEADLESS_CLI}
  libheadless
)
